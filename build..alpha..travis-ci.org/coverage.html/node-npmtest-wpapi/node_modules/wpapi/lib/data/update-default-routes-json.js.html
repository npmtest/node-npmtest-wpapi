<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-wpapi/node_modules/wpapi/lib/data/update-default-routes-json.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-wpapi">npmtest-wpapi (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-wpapi/node_modules/wpapi/lib/data/update-default-routes-json.js</span></h1>
    <h2>
        
        Statements: <span class="metric">19.51% <small>(8 / 41)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 24)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 5)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">19.51% <small>(8 / 41)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-wpapi/node_modules/wpapi/lib/data/</a> &#187; update-default-routes-json.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">//#!/bin/sh
':' //; exec "$(command -v nodejs || command -v node)" "$0" "$@"
// ^^^ Lovely polyglot script to permit usage via node _or_ via bash: see
// http://unix.stackexchange.com/questions/65235/universal-node-js-shebang
&nbsp;
/**
 * To avoid requiring that auto-discovery be utilized every time the API client
 * is initialized, this library ships with a built-in route definition from a
 * vanilla WordPress REST API installation. That file may be updated by
 * installing the API plugin on a clean WP development instance, with no other
 * plugins running, and downloading the JSON output from `yourwpsite.com/wp-json/`
 * into the "default-routes.json" file in this directory.
 *
 * That file can also be generated by running this script against the same live
 * WP REST API instance to download that same file, the difference being that,
 * if the `default-routes.json` file is downloaded through this script, it
 * will be run through the `simplifyObject` utility to cut out about 1/3 of the
 * bytes of the response by removing properties that do not effect route generation.
 *
 * This script is NOT intended to be a dependency of any part of wp.js, and is
 * provided purely as a utility for upgrading the built-in copy of the endpoint
 * response JSON file that is used to bootstrap the default route handlers.
 *
 * @example
 *
 *     # Invoke directly, run against default endpoint (details below)
 *     ./update-default-routes-json.js
 *
 *     # Invoke with `node` CLI, run against default endpoint
 *     node ./update-default-routes-json --endpoint=http://my-site.com/wp-json
 *
 * This script runs against http://wpapi.loc/wp-json by default, but it can be
 * run against an arbitrary WordPress REST API endpoint by passing the --endpoint
 * argument on the CLI:
 *
 * @example
 *
 *     # Invoke directly, run against an arbitrary WordPress API root
 *     ./update-default-routes-json.js --endpoint=http://my-site.com/wp-json
 *
 *     # Invoke with `node` CLI, run against an arbitrary WordPress API root
 *     node ./update-default-routes-json --endpoint=http://my-site.com/wp-json
 *
 * Either form will update the `default-routes.json` file in this directory,
 * providing that the endpoint data is downloaded successfully.
 *
 * This script also has some utility for downloading a custom JSON file for your
 * own WP REST API-enabled site, so that you can bootstrap your own routes without
 * incurring an HTTP request. To output to a different directory than the default
 * (which is this directory, `lib/data/`), pass an --output argument on the CLI:
 *
 * @example
 *
 *     # Output to your current working directory
 *     ./path/to/this/dir/update-default-routes-json.js --output=.
 *
 *     # Output to an arbitrary absolute path
 *     ./path/to/this/dir/update-default-routes-json.js --output=/home/mordor/output.json
 *
 * These command-line flags may be combined, and you will usually want to use
 * --endpoint alongside --output to download your own JSON into your own directory.
 */
'use strict';
&nbsp;
var agent = require( 'superagent' );
var fs = require( 'fs' );
var path = require( 'path' );
var simplifyObject = require( './simplify-object' );
&nbsp;
// Parse the arguments object
var argv = require( 'minimist' )( process.argv.slice( 2 ) );
&nbsp;
// The output directory defaults to the lib/data directory. To customize it,
// specify your own directory with --output=your/output/directory (supports
// both relative and absolute paths)
<span class="cstat-no" title="statement not covered" >var outputPath = argv.output ?</span>
	// Nested ternary, don't try this at home: this is to support absolute paths
	argv.output[ 0 ] === '/' ? argv.output : path.join( process.cwd(), argv.output ) :
	path.dirname( __filename );
&nbsp;
// Specify your own API endpoint with --endpoint=http://your-endpoint.com/wp-json
<span class="cstat-no" title="statement not covered" >var endpoint = argv.endpoint || 'http://wpapi.loc/wp-json';</span>
&nbsp;
// This directory will be called to kick off the JSON download: it uses
// superagent internally for HTTP transport that respects HTTP redirects.
<span class="fstat-no" title="function not covered" >function getJSON( cbFn ) {</span>
<span class="cstat-no" title="statement not covered" >	agent</span>
		.get( endpoint )
		.set( 'Accept', 'application/json' )
		.end(<span class="fstat-no" title="function not covered" >function( err, res ) {</span>
			// Inspect the error and then the response to infer various error states
<span class="cstat-no" title="statement not covered" >			if ( err ) {</span>
<span class="cstat-no" title="statement not covered" >				console.error( '\nSomething went wrong! Could not download endpoint JSON.' );</span>
<span class="cstat-no" title="statement not covered" >				if ( err.status ) {</span>
<span class="cstat-no" title="statement not covered" >					console.error( 'Error ' + err.status );</span>
				}
<span class="cstat-no" title="statement not covered" >				if ( err.response &amp;&amp; err.response.error ) {</span>
<span class="cstat-no" title="statement not covered" >					console.error( err.response.error );</span>
				}
<span class="cstat-no" title="statement not covered" >				return process.exit( 1 );</span>
			}
&nbsp;
<span class="cstat-no" title="statement not covered" >			if ( res.type !== 'application/json' ) {</span>
<span class="cstat-no" title="statement not covered" >				console.error( '\nError: expected response type "application/json", got ' + res.type );</span>
<span class="cstat-no" title="statement not covered" >				console.error( 'Could not save default-routes.json' );</span>
<span class="cstat-no" title="statement not covered" >				return process.exit( 1 );</span>
			}
&nbsp;
<span class="cstat-no" title="statement not covered" >			cbFn( res );</span>
		});
}
&nbsp;
// The only assumption we want to make about the URL is that it should be a web
// URL of _some_ sort, which generally means it has "http" in it somewhere. We
// can't assume much else due to how customizable the location of API root is
// within your WP install.
<span class="cstat-no" title="statement not covered" >if ( ! /http/i.test( endpoint ) ) {</span>
<span class="cstat-no" title="statement not covered" >	console.error( '\nError: ' + endpoint );</span>
<span class="cstat-no" title="statement not covered" >	console.error( 'This does not appear to be a valid URL. Please double-check the URL format\n' +</span>
		'(should be e.g. "http://your-domain.com/wp-json") and try again.' );
<span class="cstat-no" title="statement not covered" >	process.exit( 1 );</span>
}
&nbsp;
<span class="cstat-no" title="statement not covered" >fs.stat( outputPath, <span class="fstat-no" title="function not covered" >function( err, stats ) {</span></span>
<span class="cstat-no" title="statement not covered" >	if ( err || ! stats.isDirectory() ) {</span>
<span class="cstat-no" title="statement not covered" >		console.error( '\nError: ' + outputPath );</span>
<span class="cstat-no" title="statement not covered" >		console.error( 'This is not a valid directory. Please double-check the path and try again.' );</span>
<span class="cstat-no" title="statement not covered" >		process.exit( 1 );</span>
	}
&nbsp;
	// If we made it this far, our arguments look good! Carry on.
<span class="cstat-no" title="statement not covered" >	getJSON(<span class="fstat-no" title="function not covered" >function( response ) {</span></span>
		// Extract the JSON
<span class="cstat-no" title="statement not covered" >		var endpointJSON = JSON.parse( JSON.stringify( response.body ) );</span>
		// Simplify the JSON structure and pick out the routes dictionary
<span class="cstat-no" title="statement not covered" >		var slimJSON = simplifyObject( endpointJSON ).routes;</span>
&nbsp;
		// Save the file
<span class="cstat-no" title="statement not covered" >		var outputFilePath = path.join( outputPath, 'default-routes.json' );</span>
<span class="cstat-no" title="statement not covered" >		fs.writeFile( outputFilePath, JSON.stringify( slimJSON ), <span class="fstat-no" title="function not covered" >function( err ) {</span></span>
<span class="cstat-no" title="statement not covered" >			if ( err ) {</span>
<span class="cstat-no" title="statement not covered" >				console.error( '\nSomething went wrong! Could not save ' + outputFilePath );</span>
<span class="cstat-no" title="statement not covered" >				return process.exit( 1 );</span>
			}
<span class="cstat-no" title="statement not covered" >			console.log( '\nSuccessfully saved ' + outputFilePath );</span>
		});
	});
});
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Thu Apr 27 2017 20:15:57 GMT+0000 (UTC)</div>
</div>
</body>
</html>
